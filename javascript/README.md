# Javascript Backend Implementation
The following code base sets up a node server that your frontend can communicate with to execute peaq Get-Real campaign operations.

## Setup Gas Station Contracts
1. Deploy Smart Contract Found [here](https://github.com/peaqnetwork/peaq-evm-smart-contracts/tree/dev/contracts).
2. Write down deployed GasStationFactory contract address and request for agung/peaq to be sent.
3. Copy the entire file for the abi found in the `artifacts/GasStationFactory_metadata.json` and paste into the `abi/gas_station_abi.json` locally.

## Setup Server
1. Install dependencies `npm install`
2. Add `.env` file
```
PEAQ_RPC_URL="https://erpc-async.agung.peaq.network"

PEAQ_SERVICE_URL="https://lift-off-campaign-service-jx-devbr.jx.peaq.network"
SERVICE_API_KEY=""
PROJECT_API_KEY=""

GAS_STATION_ADDRESS =""
GAS_STATION_OWNER_PRIVATE_KEY=""
EOA_PRIVATE_KEY=""
```
This server must contain the GasStation owner's address so it can sign messages, and a mocked eoa private key to 'sign' messages.

3. Start the server `npm start`
4. Send Post requests


## Send Data
You can either use curl, postman, or frontend itself to send data to the server you started. In production use secure transportation protocols.

### Here are some request examples:
**http://localhost:3000/create-smart-account**

Post Data:
```
{
  "email": "user@gmail.com",
  "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
  "tag": "TEST"
}
```
Returns:
```
{
    "success": true,
    "payload": {
        "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
        "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
        "nonce": 585022693
        "deployment_status": {
            "success": true
        }
    }
}
```
**http://localhost:3000/create-storage**

Post Data:
```
{
  "email": "user@gmail.com",
  "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
  "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
  "tag": "TEST",
  "itemType": "ITEM_TYPE",
  "item": "ITEM",
  "company": "peaq",
  "nonce": 585022694
}
```
Returns:
```
{
    "success": true,
    "payload": {
        "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
        "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
        "target": "0x0000000000000000000000000000000000000801",
        "messageToSign": "0x76a024cbba31c5e81f8a333c1ee2687d50f1ba871d5c0ec0096ccc3f067960d3",
        "ownerSignature": "0x8e48c00f9843b3babe26444ac90b729b2faa8a9faa96005fa41e4b437100c0d534d471eb02f167986325c4e71f0682b0e5a594016c667452e7bc7edfe148e12d1c",
        "calldata": "0x257c3c030000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000094954454d5f54595045000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045445535400000000000000000000000000000000000000000000000000000000",
        "nonce": 585022694
    }
}
```




**http://localhost:3000/create-did**

Post Data:
```
{
  "email": "user@gmail.com",
  "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
  "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
  "tag": "TEST",
  "company": "peaq",
  "nonce": 585022693
}
```
Returns:
```
{
    "success": true,
    "payload": {
        "eoaAccount": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
        "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
        "target": "0x0000000000000000000000000000000000000800",
        "messageToSign": "0xca901ca380e095a4a55849c45ee98c411128ae32f07da45cad76727cef68594f",
        "ownerSignature": "0x1397b2106e3f916f585666deda5e6cf2ab8f5de972661898f23d1fd5a336a16e3acd63a510e1ee627fe155c72c4b1d3c431c87fa980a8e631f72493c2697a9021c",
        "calldata": "0xcc4a70ca0000000000000000000000008eda6a22eb5cbb0549292ebe51bf899cba430f9f000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000386469643a706561713a30783865644136413232654235634242303534393239326542653531624638393943426134333066394623706561710000000000000000000000000000000000000000000000000000000000000000000000000000029c306133333634363936343361373036353631373133613330373833383635363434313336343133323332363534323335363334323432333033353334333933323339333236353432363533353331363234363338333933393433343236313334333333303636333934363132333336343639363433613730363536313731336133303738333836353634343133363431333233323635343233353633343234323330333533343339333233393332363534323635333533313632343633383339333934333432363133343333333036363339343632616134303130613066323336353664363136393663353336393637366536313734373537323635313230653635366436313639366335333639363736653631373437353732363532323830303133353336363233333330333033303338363533303334333733383339333636333339333436353334333633333332363536323338363333343337363533363632333133373635363533333338363536313336363633333635363436353633333633373332363433353633363533313336363136333632333833323337333433353334333733363636333436333633333233323339333436323635363633363634333133393339333636323634333936313339333736333338363133333631363633343339333033363332363133333631333536363335333833303634363133363634333336363335363436333330333736363631363533383332333133383633326133623061303632333666373736653635373231323035366637373665363537323232326133303738333336353333343634363331333633303338333334323636333036313334333433343432333836363436333833363433333733313335333636353432333333333336333836353333363336353636343200000000",
        "nonce": 585022693
    }
}
```




**http://localhost:3000/execute-machine-tx**
Post Data:
```
{
    "eoaAddress": "0x4e3FF16083Bf0a333B8fF86C7156eB3368e3cecf",
    "machineAddress": "0x8edA6A22eB5cBB0549292eBe51bF899CBa430f9D",
    "target": "0x0000000000000000000000000000000000000800",
    "messageToSign": "0xca901ca380e095a4a55849c45ee98c411128ae32f07da45cad76727cef68594f",
    "ownerSignature": "0x1397b2106e3f916f585666deda5e6cf2ab8f5de972661898f23d1fd5a336a16e3acd63a510e1ee627fe155c72c4b1d3c431c87fa980a8e631f72493c2697a9021c",
    "calldata": "0xcc4a70ca0000000000000000000000008eda6a22eb5cbb0549292ebe51bf899cba430f9f000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000386469643a706561713a30783865644136413232654235634242303534393239326542653531624638393943426134333066394623706561710000000000000000000000000000000000000000000000000000000000000000000000000000029c306133333634363936343361373036353631373133613330373833383635363434313336343133323332363534323335363334323432333033353334333933323339333236353432363533353331363234363338333933393433343236313334333333303636333934363132333336343639363433613730363536313731336133303738333836353634343133363431333233323635343233353633343234323330333533343339333233393332363534323635333533313632343633383339333934333432363133343333333036363339343632616134303130613066323336353664363136393663353336393637366536313734373537323635313230653635366436313639366335333639363736653631373437353732363532323830303133353336363233333330333033303338363533303334333733383339333636333339333436353334333633333332363536323338363333343337363533363632333133373635363533333338363536313336363633333635363436353633333633373332363433353633363533313336363136333632333833323337333433353334333733363636333436333633333233323339333436323635363633363634333133393339333636323634333936313339333736333338363133333631363633343339333033363332363133333631333536363335333833303634363133363634333336363335363436333330333736363631363533383332333133383633326133623061303632333666373736653635373231323035366637373665363537323232326133303738333336353333343634363331333633303338333334323636333036313334333433343432333836363436333833363433333733313335333636353432333333333336333836353333363336353636343200000000",
    "nonce": 585022693
}
```
Returns:
```
{
    "success": true,
    "payload": {
        "nonce": 585022694
    }
}
```

# TODO
- Create a wrapped sdk that contains 3 Service classes
1. GasStationService
2. GetRealService
3. peaqSdkEvm Service

Wrap all these services and expected flows in a GetRealSdk.js, which acts as a “coordinator”. Then a user can create a new instance of this coordinator to easily use the services it offers.

# QUESTIONS
- Currently hardcoding gas -> what is the best strategy
- Nonce management/storage
- transaction mempool

- How to call get-real backend to confirm storage/did creation?